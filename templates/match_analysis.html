{% extends 'base.html' %}

{% block title %}Match Analysis{% endblock %}

{% block dropdowns %}
    {% include 'partials/competition_dropdowns.html' %}
{% endblock %}

{% block content %}
<div class="analysis-container">
    <div class="analysis-nav">
        <button class="tab-btn active" data-tab="overview">Overview</button>
        <button class="tab-btn" data-tab="home">Home Team</button>
        <button class="tab-btn" data-tab="away">Away Team</button>
        <button class="tab-btn" data-tab="player">Player</button>
    </div>

    <!-- OVERVIEW TAB -->
    <div class="analysis-content" id="overview">
        <!-- Layout toggle button -->
        <div class="layout-toggle">
            <button id="toggle-layout-btn" class="toggle-btn">Switch to Compact Layout</button>
        </div>

        <div class="graphs-container wide-mode">
            <div id="graph-container-1" class="graph-container block-6x1 hidden"></div>

            <div id="graph-container-2" class="graph-container block-12x2 hidden">
                <div class="graph-inner">
                    <div id="match-summary">
                        <div class="score-header">
                            <h3 id="combined-score-header">
                                <span id="home-team-name" class="home-team-name"></span>
                                <span id="home-team-score" class="team-score"></span>
                                <span id="score-seperator" class="score-seperator"></span>
                                <span id="away-team-score" class="team-score"></span>
                                <span id="away-team-name" class="away-team-name"></span>
                            </h3>
                            <p id="extra-details"></p>
                        </div>
                    </div>

                    <div class="team-tables">
                        <div class="team-table">
                            <table id="home-team-table"><tbody></tbody></table>
                        </div>
                        <div class="team-table">
                            <table id="away-team-table"><tbody></tbody></table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="graph-container-3" class="graph-container block-6x1 hidden"></div>

            <div id="graph-container-4" class="graph-container block-6x2 hidden" data-plot-group="dominance">
                <div class="graph-inner vertical">
                    <div class="dominance-toggle-buttons">
                        <button class="toggle-btn active" data-view="dominance_heatmap">Full Match</button>
                        <button class="toggle-btn" data-view="dominance_heatmap_first">1st Half</button>
                        <button class="toggle-btn" data-view="dominance_heatmap_second">2nd Half</button>
                    </div>
                    <div id="dominance-plot-container" class="plotly-wrapper"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- HOME TEAM TAB -->
    <div class="analysis-content hidden" id="home">
        <div class="layout-toggle">
            <button id="toggle-layout-btn-home" class="toggle-btn">Switch to Compact Layout</button>
        </div>
        <div class="graphs-container wide-mode">
            <div id="graph-container-home-team-4" class="graph-container block-12x2 hidden">
                {% set prefix = 'home_team_heatmap' %}
                {% set plot_container_id = 'heatmap-home-plot-container' %}
                {% include 'partials/match_team_analysis.html' with context %}
            </div>
        </div>
    </div>

    <!-- AWAY TEAM TAB -->
    <div class="analysis-content hidden" id="away">
        <div class="layout-toggle">
            <button id="toggle-layout-btn-away" class="toggle-btn">Switch to Compact Layout</button>
        </div>
        <div class="graphs-container wide-mode">
            <div id="graph-container-away-team-4" class="graph-container block-12x2 hidden">
                {% set prefix = 'away_team_heatmap' %}
                {% set plot_container_id = 'heatmap-away-plot-container' %}
                {% include 'partials/match_team_analysis.html' with context %}
            </div>
        </div>
    </div>

    <!-- PLAYER TAB -->
    <div class="analysis-content hidden" id="player">
        <div class="layout-toggle">
            <button id="toggle-layout-btn-player" class="toggle-btn">Switch to Compact Layout</button>
        </div>
        <div class="graphs-container wide-mode">
            <div class="graph-container block-12x1">
                <p style="text-align: center;">Player analysis goes here.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
<script>
  $(document).ready(function () {
    $('.searchable-dropdown').select2();

    function setupToggle(buttonId) {
      $(`#${buttonId}`).on('click', function () {
        const container = $(this).closest('.analysis-content').find('.graphs-container');
        container.toggleClass('compact-mode wide-mode');

        const isCompact = container.hasClass('compact-mode');
        $(this).text(isCompact ? 'Switch to Wide Layout' : 'Switch to Compact Layout');
      });
    }

    // Apply toggle logic for each tab
    setupToggle('toggle-layout-btn');
    setupToggle('toggle-layout-btn-home');
    setupToggle('toggle-layout-btn-away');
    setupToggle('toggle-layout-btn-player');
  });
</script>
<script src="{{ url_for('static', filename='js/match_analysis.js') }}"></script>
{% endblock %}
