{% extends 'base.html' %}

{% block title %}Match Analysis{% endblock %}

{% block dropdowns %}
    {% include 'partials/competition_dropdowns.html' %}
{% endblock %}

{% block content %}
<div class="analysis-container">
    <div class="analysis-nav">
        <button class="tab-btn active" data-tab="overview">Overview</button>
        <button class="tab-btn" data-tab="home">Home Team</button>
        <button class="tab-btn" data-tab="away">Away Team</button>
        <button class="tab-btn" data-tab="player">Player</button>
    </div>

    <!-- OVERVIEW TAB -->
    <div class="analysis-content" id="overview">
          <div class="layout-toggle">
            <button id="toggle-layout-btn" class="toggle-btn">Switch to Compact Layout</button>
          </div>

          <div class="graphs-container wide-mode">
            <!-- Top left: xG -->
            <div id="graph-container-xg" class="graph-container xg">
              <div id="xg-plot-container" class="plotly-wrapper"></div>
            </div>

            <!-- Bottom left: Momentum -->
            <div id="graph-container-momentum" class="graph-container momentum">
              <div id="momentum-plot-container" class="plotly-wrapper"></div>
            </div>

            <!-- Center: Summary & Lineups -->
            <div id="graph-container-summary" class="graph-container summary">
              <div class="graph-inner">
                <div id="match-summary">
                  <div class="score-header">
                    <h3 id="combined-score-header">
                      <span id="home-team-name" class="home-team-name"></span>
                      <span id="home-team-score" class="team-score"></span>
                      <span id="score-seperator" class="score-seperator"></span>
                      <span id="away-team-score" class="team-score"></span>
                      <span id="away-team-name" class="away-team-name"></span>
                    </h3>
                    <p id="extra-details"></p>
                  </div>
                </div>

                <div class="team-tables">
                  <div class="team-table">
                    <table id="home-team-table"><tbody></tbody></table>
                  </div>
                  <div class="team-table">
                    <table id="away-team-table"><tbody></tbody></table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Right: Heatmap -->
            <div id="graph-container-heatmap" class="graph-container heatmap" data-plot-group="dominance">
              <div class="graph-inner vertical">
                <div class="dominance-toggle-buttons">
                  <button class="toggle-btn active" data-view="dominance_heatmap">Full Match</button>
                  <button class="toggle-btn" data-view="dominance_heatmap_first">1st Half</button>
                  <button class="toggle-btn" data-view="dominance_heatmap_second">2nd Half</button>
                </div>
                <div id="dominance-plot-container" class="plotly-wrapper"></div>
              </div>
            </div>
          </div>
        </div>


    <!-- HOME TEAM TAB -->
    <div class="analysis-content hidden" id="home">
      <div class="graphs-container wide-mode">
      </div>
    </div>

    <!-- AWAY TEAM TAB -->
    <div class="analysis-content hidden" id="away">
      <div class="graphs-container wide-mode">
      </div>
    </div>

    <!-- PLAYER TAB -->
    <div class="analysis-content hidden" id="player">
        <div class="layout-toggle">
            <button id="toggle-layout-btn-player" class="toggle-btn">Switch to Compact Layout</button>
        </div>
        <div class="graphs-container wide-mode">
            <div class="graph-container block-12x1">
                <p style="text-align: center;">Player analysis goes here.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
<script>
  $(document).ready(function () {
    $('.searchable-dropdown').select2();

    function setupToggle(buttonId) {
      $(`#${buttonId}`).on('click', function () {
        const container = $(this).closest('.analysis-content').find('.graphs-container');
        container.toggleClass('compact-mode wide-mode');

        const isCompact = container.hasClass('compact-mode');
        $(this).text(isCompact ? 'Switch to Wide Layout' : 'Switch to Compact Layout');
      });
    }

    // Apply toggle logic for each tab
    setupToggle('toggle-layout-btn');
    setupToggle('toggle-layout-btn-home');
    setupToggle('toggle-layout-btn-away');
    setupToggle('toggle-layout-btn-player');
  });
</script>
<script src="{{ url_for('static', filename='js/match_analysis.js') }}"></script>
<script>
  $(document).ready(function () {
    $('.searchable-dropdown').select2();

    $('#layout-toggle-checkbox').on('change', function () {
      const compact = $(this).is(':checked');
      $('.graphs-container').each(function () {
        $(this).toggleClass('compact-mode', compact);
        $(this).toggleClass('wide-mode', !compact);
      });

      $('.toggle-label').text(compact ? 'Wide Layout' : 'Compact Layout');
    });
  });
</script>
{% endblock %}
